/*
===============================================================================
 Name        : fft_rfft.c
 Author      : $(author)
 Version     :
 Copyright   : $(copyright)
 Description : main definition
===============================================================================
*/

#include <stdio.h>
#include "arm_math.h"

#define N_SAMPLES 256

/* 1KHz + 4KHz signal */
float32_t input_data[N_SAMPLES] = {
	0.00,1.11,2.20,3.28,4.33,5.35,6.31,7.22,8.07,8.85,9.56,10.18,10.71,11.16,11.51,11.76,11.92,11.98,11.94,11.80,11.57,11.25,10.85,10.36,9.79,9.16,8.46,7.71,6.91,6.07,5.21,4.32,3.42,
	2.53,1.64,0.77,-0.08,-0.89,-1.65,-2.36,-3.01,-3.59,-4.10,-4.54,-4.88,-5.14,-5.31,-5.39,-5.37,-5.26,-5.05,-4.76,-4.37,-3.90,-3.34,-2.71,-2.01,-1.24,-0.42,0.45,1.37,2.31,3.28,4.26,5.25,
	6.23,7.19,8.13,9.04,9.90,10.72,11.47,12.16,12.78,13.31,13.76,14.12,14.39,14.56,14.63,14.60,14.47,14.24,13.92,13.50,12.99,12.39,11.72,10.96,10.14,9.25,8.32,7.33,6.32,5.27,4.21,3.13,
	2.06,1.00,-0.04,-1.04,-2.02,-2.94,-3.81,-4.61,-5.35,-6.01,-6.59,-7.08,-7.48,-7.79,-8.01,-8.13,-8.15,-8.08,-7.92,-7.66,-7.32,-6.89,-6.39,-5.82,-5.18,-4.48,-3.74,-2.95,-2.13,-1.29,-0.43,0.43,
	1.29,2.13,2.95,3.74,4.48,5.18,5.82,6.39,6.89,7.32,7.66,7.92,8.08,8.15,8.13,8.01,7.79,7.48,7.08,6.59,6.01,5.35,4.61,3.81,2.94,2.02,1.04,0.04,-1.00,-2.06,-3.13,-4.21,
	-5.27,-6.32,-7.33,-8.32,-9.25,-10.14,-10.96,-11.72,-12.39,-12.99,-13.50,-13.92,-14.24,-14.47,-14.60,-14.63,-14.56,-14.39,-14.12,-13.76,-13.31,-12.78,-12.16,-11.47,-10.72,-9.90,-9.04,-8.13,-7.19,-6.23,-5.25,-4.26,
	-3.28,-2.31,-1.37,-0.45,0.42,1.24,2.01,2.71,3.34,3.90,4.37,4.76,5.05,5.26,5.37,5.39,5.31,5.14,4.88,4.54,4.10,3.59,3.01,2.36,1.65,0.89,0.08,-0.77,-1.64,-2.53,-3.42,-4.32,
	-5.21,-6.07,-6.91,-7.71,-8.46,-9.16,-9.79,-10.36,-10.85,-11.25,-11.57,-11.80,-11.94,-11.98,-11.92,-11.76,-11.51,-11.16,-10.71,-10.18,-9.56,-8.85,-8.07,-7.22,-6.31,-5.35,-4.33,-3.28,-2.20,-1.11,-0.00,
};

/**
 * @brief Main program
 */
int main(void) {
	/* RFFT instance */
	arm_rfft_fast_instance_f32 rfft_instance;
	/* Normal FFT */
	uint32_t ifft_flag = 0;
	/* FFT number of samples */
	uint32_t fft_size = N_SAMPLES;
	/* FFT output variable */
	float32_t fft_output[N_SAMPLES];
	/* FFT bin magnitudes */
	float32_t fft_mag[N_SAMPLES / 2];
	/* Initialize RFFT instance */
	arm_status status = arm_rfft_fast_init_f32(&rfft_instance, fft_size);
	/* Catch error in ARM math */
	while(status != ARM_MATH_SUCCESS);
	/* Process the data through the RFFT/RIFFT module */
	arm_rfft_fast_f32(&rfft_instance, input_data, fft_output, ifft_flag);
	/* Calculate the magnitude at each bin, it's symmetrical */
	arm_cmplx_mag_f32(fft_output, fft_mag, fft_size / 2);
	/* Print output values */
	printf("Output values from RFFT\n");
	for(uint32_t i = 0; i < fft_size / 2; i++) { 
		/* Print value */
		printf("%.2f,  ", fft_mag[i]);
		/* Print a new line every 32 values */
		if(i % 32 == 0) { printf("\n"); }
	}
	while(1);
	return 0;
}
